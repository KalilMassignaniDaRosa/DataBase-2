@model EFTest.Models.Courses.Course
@{
    ViewData["Title"] = $"Overview - {Model.Name}";
}

<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold text-primary">
                <i class="fa-solid fa-book"></i> @Model.Name
            </h2>
            <span class="text-muted">ID: @Model.ID</span>
        </div>

        <a asp-controller="Course" asp-action="AddModuleToCourse" asp-route-courseId="@Model.ID"
           class="btn btn-success">
            <i class="fa-solid fa-plus"></i> Add Module
        </a>
    </div>

    <div class="card shadow-lg rounded-3">
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <thead class="table-dark">
                    <tr>
                        <th class="text-center" style="width:10%;"><i class="fa-solid fa-layer-group"></i> Semester</th>
                        <th class="text-center" style="width:5%;"><i class="fa-solid fa-id-card"></i> Id</th>
                        <th style="width:25%;"><i class="fa-solid fa-bookmark"></i> Module</th>
                        <th class="text-center" style="width:10%;"><i class="fa-solid fa-calendar-days"></i> Day</th>
                        <th style="width:25%;"><i class="fa-solid fa-list"></i> Prerequisites</th>
                        <th class="text-center" style="width:15%;"><i class="fa-solid fa-pen-to-square"></i> Update</th>
                        <th class="text-center" style="width:10%;"><i class="fa-solid fa-trash"></i> Delete</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var cm in Model.CourseModules
                    .OrderBy(cm => cm.Semester)
                    .ThenBy(cm => cm.Module.Name))
                    {
                        <tr class="align-middle">
                            <td class="text-center">@cm.Semester</td>
                            <td class="text-center">@cm.Module.ID</td>
                            <td>@cm.Module.Name</td>
                            <td class="text-center">@((cm.DayOfWeek.HasValue) ? cm.DayOfWeek.ToString() : "None")</td>
                            <td>
                                @if (cm.Module.Prerequisites != null && cm.Module.Prerequisites.Any())
                                {
                                    @string.Join(", ", cm.Module.Prerequisites.Select(p => p.Prerequisite!.Name))
                                }
                                else
                                {
                                    <span class="text-muted">None</span>
                                }
                            </td>

                            <!-- Botoes -->
                            <td class="text-center">
                                <form asp-controller="Course" asp-action="EditModule" method="get" class="d-inline">
                                    <input type="hidden" name="courseId" value="@Model.ID" />
                                    <input type="hidden" name="moduleId" value="@cm.ModuleID" />
                                    <button type="submit" class="btn btn-warning btn-sm px-2 py-1">
                                        <i class="fa-solid fa-pen-to-square"></i>
                                    </button>
                                </form>
                            </td>

                            <td class="text-center">
                                <form asp-controller="Course" asp-action="RemoveModuleFromCourse" method="post" class="d-inline"
                                      onsubmit="return confirm('Are you sure you want to remove this module from the course?');">
                                    <input type="hidden" name="courseId" value="@Model.ID" />
                                    <input type="hidden" name="moduleId" value="@cm.ModuleID" />
                                    <button type="submit" class="btn btn-danger btn-sm px-2 py-1">
                                        <i class="fa-solid fa-trash"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>